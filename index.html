<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025/03/02 Ê±™Â≠üÊ¥ã+ÈôàÁÇúÂçöÂ©öÁ§ºÈÇÄËØ∑ÂáΩ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            margin: 0;
            padding: 0;
            height: 100vh;
            background-color: black;
            color: white;
            font-family: sans-serif;
            overflow: hidden;
        }
        #canvas {
            width: 100vw;
            height: 100vh;
            padding: 0;
            margin: 0;
        }
        .emoji {
            position: fixed;
            pointer-events: none;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .emoji-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .name {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color:#FF0DB2FF;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
            /* background-color: pink;
            padding: 0.1em 0.1em; */
            font-size: 0.18em;
            white-space: nowrap;
            z-index: 1;
            font-family: 'Noto Sans SC', sans-serif;
            font-weight: 500;
            letter-spacing: 0.08em;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script>
        // Determine target page from URL
        const path = window.location.pathname;
        let targetPage = sessionStorage.getItem('targetPage');
        if (!targetPage) {
            targetPage = 'https://notsofunny.us' + (path.includes('evening') ? '/evening' : '/afternoon');
        }
        
        // Matter.js setup
        const Engine = Matter.Engine,
            Render = Matter.Render,
            Runner = Matter.Runner,
            Bodies = Matter.Bodies,
            Composite = Matter.Composite;

        // Create engine and world
        const engine = Engine.create();
        const world = engine.world;
        engine.gravity.y = 0.6;

        // Create renderer
        const render = Render.create({
            element: document.body,
            engine: engine,
            options: {
                width: window.innerWidth,
                height: window.innerHeight,
                wireframes: false,
                background: 'transparent'
            }
        });

        // Create ground and walls
        const ground = Bodies.rectangle(window.innerWidth/2, window.innerHeight, window.innerWidth, 60, { 
            isStatic: true,
            render: { fillStyle: 'transparent' }
        });
        const leftWall = Bodies.rectangle(0, window.innerHeight/2, 60, window.innerHeight, { 
            isStatic: true,
            render: { fillStyle: 'transparent' }
        });
        const rightWall = Bodies.rectangle(window.innerWidth, window.innerHeight/2, 60, window.innerHeight, { 
            isStatic: true,
            render: { fillStyle: 'transparent' }
        });

        // Add ground and walls to world
        Composite.add(world, [ground, leftWall, rightWall]);

        // Create disco ball with random properties
        function createDiscoBall(index) {
            const ball = document.createElement('div');
            ball.className = 'emoji';
            ball.style.position = 'fixed';
            ball.style.willChange = 'transform';
            
            const container = document.createElement('div');
            container.className = 'emoji-container';
            container.style.animation = `spin ${2 + Math.random() * 2}s linear infinite`;
            
            // Make the first ball special
            if (index === 0) {
                container.textContent = 'ü™©';
                ball.style.fontSize = '20vmin';
            } else {
                // Create emoji and name in the same container
                const emojiText = document.createElement('div');
                emojiText.textContent = 'ü™©';
                container.appendChild(emojiText);
                
                // Add name
                const name = document.createElement('div');
                name.className = 'name';
                name.textContent = index % 2 === 0 ? 'Ê±™Â≠üÊ¥ã' : 'ÈôàÁÇúÂçö';
                container.appendChild(name);
                
                ball.style.fontSize = `${15 + Math.random() * 20}vmin`;
            }
            
            ball.appendChild(container);
            document.body.appendChild(ball);

            // Calculate radius based on orientation
            const radius = window.innerWidth > window.innerHeight ? 
                parseFloat(ball.style.fontSize) * window.innerHeight / 100 / 2 : 
                parseFloat(ball.style.fontSize) * window.innerWidth / 100 / 2;

            const discoBall = Bodies.circle(
                radius + Math.random() * (window.innerWidth - 2 * radius),
                -radius - Math.random() * window.innerHeight,
                radius,
                {
                    restitution: 0.3 + Math.random() * 0.3,
                    friction: 0.15,
                    render: { fillStyle: 'transparent' }
                }
            );

            // Add random initial velocity
            Matter.Body.setVelocity(discoBall, {
                x: (Math.random() - 0.5) * 5,
                y: Math.random() * 3
            });

            // Update emoji position to match physics body
            Matter.Events.on(engine, 'afterUpdate', () => {
                ball.style.left = `${discoBall.position.x - radius}px`;
                ball.style.top = `${discoBall.position.y - radius}px`;
                
                // Adjust removal distance based on orientation
                const removalDistance = window.innerWidth > window.innerHeight ? 
                    window.innerHeight * 1.2 : 
                    window.innerHeight * 2;   
                
                if (discoBall.position.y > removalDistance) {
                    ball.remove();
                }
            });

            return discoBall;
        }

        // Create multiple disco balls with slight delay
        let ballsAdded = 0;
        let isScreenFull = false;
        let dropStarted = false;
        const MAX_BALLS = 30;
        
        function checkShouldDrop() {
            const bodies = Composite.allBodies(world);
            let settledBalls = 0;
            let totalArea = 0;
            const screenArea = window.innerWidth * window.innerHeight;
            
            bodies.forEach(body => {
                if (body.velocity.y < 0.1 && body.position.y > window.innerHeight * 0.7) {
                    settledBalls++;
                    totalArea += Math.PI * body.circleRadius * body.circleRadius;
                }
            });
            
            // Drop when either screen is 40% full or we've added MAX_BALLS
            const shouldDrop = (totalArea > screenArea * 0.6) || (ballsAdded >= MAX_BALLS);
            
            // If conditions met, initiate the drop
            if (shouldDrop && !dropStarted) {
                dropStarted = true;
                setTimeout(() => {
                    // Remove all static bodies (ground and walls)
                    const staticBodies = bodies.filter(body => body.isStatic);
                    Composite.remove(world, staticBodies);
                    
                    // Add random horizontal velocities to all balls
                    const activeBodies = Composite.allBodies(world);
                    activeBodies.forEach(body => {
                        Matter.Body.setVelocity(body, {
                            x: (Math.random() - 0.5) * 10,
                            y: body.velocity.y
                        });
                    });

                    // Start with lower gravity and gradually increase it
                    engine.gravity.y = 1;
                    let gravityInterval = setInterval(() => {
                        engine.gravity.y += 0.3;
                        
                        // Add more random horizontal movement periodically
                        activeBodies.forEach(body => {
                            const currentVel = body.velocity;
                            Matter.Body.setVelocity(body, {
                                x: currentVel.x + (Math.random() - 0.5) * 1.5,
                                y: currentVel.y
                            });
                        });

                        if (engine.gravity.y >= 3) {
                            clearInterval(gravityInterval);
                        }
                    }, 200);

                    // Check if all balls are off screen
                    function checkAllBallsOffScreen() {
                        const activeBodies = Composite.allBodies(world);
                        const removalDistance = window.innerWidth > window.innerHeight ? 
                            window.innerHeight * 1.2 : 
                            window.innerHeight * 2;   
                        
                        const allOffScreen = activeBodies.every(body => 
                            body.position.y > removalDistance
                        );
                        
                        if (allOffScreen) {
                            if (gravityInterval) clearInterval(gravityInterval);
                            sessionStorage.setItem('fromAnimation', 'true');
                            window.location.href = targetPage;
                        } else {
                            setTimeout(checkAllBallsOffScreen, 100);
                        }
                    }
                    
                    // Start checking for balls off screen
                    setTimeout(checkAllBallsOffScreen, 500);
                }, 2000);
            }
            
            return shouldDrop;
        }
        
        function addBall() {
            if (!isScreenFull && ballsAdded < MAX_BALLS) {
                const discoBall = createDiscoBall(ballsAdded);
                Composite.add(world, discoBall);
                ballsAdded++;
                
                // Check if we should drop every 5 balls
                if (ballsAdded % 5 === 0) {
                    isScreenFull = checkShouldDrop();
                }
                
                // Schedule next ball if we shouldn't drop yet
                if (!isScreenFull && ballsAdded < MAX_BALLS) {
                    setTimeout(addBall, 200);
                } else {
                    checkShouldDrop(); // One final check to trigger drop if needed
                }
            }
        }

        // Start adding balls
        addBall();

        // Run the engine
        Render.run(render);
        const runner = Runner.create();
        Runner.run(runner, engine);

        // Handle window resize
        window.addEventListener('resize', () => {
            render.canvas.width = window.innerWidth;
            render.canvas.height = window.innerHeight;
            Matter.Body.setPosition(ground, Matter.Vector.create(window.innerWidth/2, window.innerHeight));
            Matter.Body.setPosition(rightWall, Matter.Vector.create(window.innerWidth, window.innerHeight/2));
        });
    </script>
</body>
</html>

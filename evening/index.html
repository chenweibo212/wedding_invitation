<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta property="og:type" content="website" />
    <meta property="og:title" content="æ±ªå­Ÿæ´‹&é™ˆç‚œåšçš„å©šç¤¼é‚€è¯·å‡½" />
    <meta property="og:description" content="è¯šæŒšé‚€è¯·æ‚¨å‚åŠ æˆ‘ä»¬çš„å©šç¤¼" />
    <meta property="og:image" content="http://wnsw.caddk.cn/img/share-icon.png" />
    <meta property="og:url" content="https://wnsw.caddk.cn/" />
    <title>æ±ªå­Ÿæ´‹&é™ˆç‚œåšçš„å©šç¤¼é‚€è¯·å‡½</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Futura:wght@700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC&display=swap">
    <link rel="stylesheet" href="./styles.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script>
        // è·å–åŸºç¡€URLçš„å‡½æ•°
        function getBaseUrl() {
            const hostname = window.location.hostname;
            if (hostname === 'localhost') {
                return 'http://localhost:3000';
            } else if (hostname === 'wedding.zeabur.app') {
                return 'https://wedding.zeabur.app';
            } else {
                return 'https://wnsw.caddk.cn';
            }
        }

        // æ›´æ–°Open Graph metaæ ‡ç­¾
        function updateMetaTags() {
            const baseUrl = getBaseUrl();
            const urlParams = new URLSearchParams(window.location.search);
            const wid = urlParams.get('wid');
            const currentPath = window.location.pathname;

            // è·å–å®¾å®¢ä¿¡æ¯
            async function getGuestInfo() {
                if (wid) {
                    try {
                        const response = await fetch(`${baseUrl}/api/guest/${wid}`);
                        const data = await response.json();
                        return data;
                    } catch (error) {
                        console.error('Error fetching guest info:', error);
                        return null;
                    }
                }
                return null;
            }

            // æ›´æ–°metaæ ‡ç­¾
            async function updateTags() {
                const guestInfo = await getGuestInfo();
                let title = 'æ±ªå­Ÿæ´‹&é™ˆç‚œåšçš„å©šç¤¼é‚€è¯·å‡½';
                let description = 'è¯šæŒšé‚€è¯·æ‚¨å‚åŠ æˆ‘ä»¬çš„å©šç¤¼';
                
                if (guestInfo && guestInfo.success) {
                    description = `è¯šæŒšé‚€è¯·${guestInfo.name}${guestInfo.note || ''}å‚åŠ æˆ‘ä»¬çš„å©šç¤¼`;
                }

                // æ ¹æ®å½“å‰é¡µé¢è®¾ç½®ä¸åŒçš„æè¿°
                if (currentPath.includes('/afternoon')) {
                    description += ' - ğŸ’•';
                } else if (currentPath.includes('/evening')) {
                    description += ' - ğŸ©·';
                }

                // æ›´æ–°metaæ ‡ç­¾
                document.querySelector('meta[property="og:title"]').setAttribute('content', title);
                document.querySelector('meta[property="og:description"]').setAttribute('content', description);
                document.querySelector('meta[property="og:image"]').setAttribute('content', `${baseUrl}/img/share-icon.png`);
                document.querySelector('meta[property="og:url"]').setAttribute('content', window.location.href);
            }

            updateTags();
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ›´æ–°metaæ ‡ç­¾
        document.addEventListener('DOMContentLoaded', updateMetaTags);

        //Check if we came directly or from animation
        if (!sessionStorage.getItem('fromAnimation')) {
            const urlParams = new URLSearchParams(window.location.search);
            const wid = urlParams.get('wid');
            const baseUrl = getBaseUrl();
            const targetPage = `/evening${wid ? `?wid=${wid}` : ''}`;
            sessionStorage.setItem('targetPage', targetPage);
            window.location.href = `${baseUrl}${wid ? `?wid=${wid}` : ''}`;
        }
        sessionStorage.removeItem('fromAnimation');
    </script>
</head>
<body>
    <div class="container">
        <div class="page current" id="page1">
            <div class="tetris-container">
                <div class="tetris-shape"></div>
            </div>
            <div class="text-content">
                <h1>è¯šæŒšé‚€è¯·æ‚¨æ¥å‚åŠ æˆ‘ä»¬çš„å©šç¤¼</h1>
                <h2 class="wedding-text">/  WEDDING<br>INVITATION</h2>
                <div class="info-container">
                    <div class="names">æ±ªå­Ÿæ´‹<br><span class="plus">+</span><br>é™ˆç‚œåš</div>
                </div>
                <div class="venue-info">
                    <div class="info-container-2">
                        <div class="location">
                            å©šç¤¼æ—¶é—´ï¼š 
                            <a href="webcal://notsofunny.us/evening/wedding.ics"
                               type="text/calendar"
                               class="calendar-link">2025.03.02 æ˜ŸæœŸæ—¥</a><br>
                            å©šç¤¼åœ°ç‚¹ï¼š
                            <a href="androidamap://navi?sourceApplication=wedding&lat=30.238083&lon=120.155611&keywords=æ­å·è¥¿æ¹–æŸ³èºé‡Œé…’åº—&dev=0&style=2" 
                               onclick="openMaps('æ­å·è¥¿æ¹–æŸ³èºé‡Œé…’åº—', 30.238083, 120.155611); return false;" 
                               class="map-link">
                                æ­å·è¥¿æ¹–æŸ³èºé‡Œé…’åº—
                            </a>
                        </div>
                        <div class="schedule"> 
                            <!-- <div class="event">15:16<br>ç¢§æ¹–è½©å°è‰åª</div> -->
                            <div class="event">\ æ¬¢é¢œåº† \<br>17:18&emsp;&emsp;äº”å·æ¥¼æŸ³èºå…</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="./script.js"></script> 
</body>
</html>
